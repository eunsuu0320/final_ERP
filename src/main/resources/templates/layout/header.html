<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8" />
<title>Header</title>
</head>
<body>
	<div th:fragment="header">
		<nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
			<a class="navbar-brand ps-3" href="/dashboard">구독핑 이알핑</a>

			<button class="btn btn-link btn-sm order-1 order-lg-0 me-4 me-lg-0"
				id="sidebarToggle">
				<i class="fas fa-bars"></i>
			</button>

			<form
				class="d-none d-md-inline-block form-inline ms-auto me-0 me-md-3 my-2 my-md-0"></form>

			<ul class="navbar-nav ms-auto ms-md-0 me-3 me-lg-4">
				<li class="nav-item dropdown"><a
					class="nav-link dropdown-toggle" id="navbarDropdown" href="#"
					role="button" data-bs-toggle="dropdown" aria-expanded="false">
						<i class="fas fa-user fa-fw"></i>
				</a>

					<ul class="dropdown-menu dropdown-menu-end up-menu p-0"
						aria-labelledby="navbarDropdown">
						<li class="up-wrap"
							    th:with="
							      parts=${#strings.arraySplit(#authentication?.name, ':')},
							
							      company=${(parts != null and parts.length > 0) ? parts[0] : ''},
							      userId=${(parts != null and parts.length > 1) ? parts[1] : ''},
							      empCodeRaw=${(parts != null and parts.length > 2) ? parts[2] : ''},
							      roleCode=${(parts != null and parts.length > 3) ? parts[3] : ''},
							      empNameRaw=${(parts != null and parts.length > 4) ? parts[4] : ''},
							      deptRaw=${(parts != null and parts.length > 5) ? parts[5] : ''},
							      roleRemk=${(parts != null and parts.length > 6) ? parts[6] : ''},
							
							      empName=${!#strings.isEmpty(empNameRaw) ? empNameRaw : (!#strings.isEmpty(userId) ? userId : '관리자')},
							      empInitial=${!#strings.isEmpty(empName) ? #strings.substring(empName,0,1) : 'A'},
							      empCode=${!#strings.isEmpty(empCodeRaw) ? empCodeRaw : 'MASTER'},
							      deptName=${!#strings.isEmpty(deptRaw) ? deptRaw : '-'},
							
							      auths=${#authentication?.authorities},
							      authRole=${(auths != null and auths.size() > 0) ? auths[0].authority : ''},
							      roleDisp=${
							        !#strings.isEmpty(authRole)
							          ? ( #strings.startsWith(authRole,'ROLE_') ? #strings.substring(authRole,5) : authRole )
							          : ( !#strings.isEmpty(roleRemk)
							                ? roleRemk
							                : ( #strings.startsWith(roleCode,'ROLE_') ? #strings.substring(roleCode,5) : roleCode )
							            )
							      }
							    ">
							<div class="up-card">
								<div class="up-avatar" th:text="${empInitial}">A</div>

								<div class="up-meta">
									<div class="up-name" th:text="${empName}">관리자</div>
									<div class="up-dept" th:text="${deptName}">-</div>

									<div class="up-badges">
										<span class="up-badge">ID: <span
											th:text="${!#strings.isEmpty(userId) ? userId : 'admin'}">admin</span>
										</span> <span class="up-badge">사번: <span th:text="${empCode}">MASTER</span>
										</span>
									</div>
								</div>
							</div>

							<hr class="up-divide" />

							<div class="up-list">
								<div class="up-item">
									<span class="up-label">회사코드</span> <span class="up-value"
										th:text="${!#strings.isEmpty(company) ? company : 'C001'}">C001</span>
								</div>
								<div class="up-item">
								  <span class="up-label">권한</span>
								  <span class="up-value" th:text="${ roleDisp }">MASTER</span>
								</div>
							</div>

							<div class="up-actions">
								<a class="up-btn up-btn--ghost" href="/dashboard">대시보드</a> <a
									class="up-btn up-btn--primary" href="#"
									onclick="event.preventDefault(); document.getElementById('logoutForm').submit();">
									로그아웃 </a>
							</div>
						</li>
					</ul>

					<style>
.dropdown-menu.up-menu {
	min-width: 280px;
	border: none;
	border-radius: 10px;
	padding: 0 !important
}

.dropdown-menu.up-menu.show {
	padding: 0 !important
}

.dropdown-menu.up-menu .up-wrap {
	padding: 14px
}

.dropdown-menu.up-menu .up-card {
	display: grid;
	grid-template-columns: 56px 1fr;
	gap: 12px;
	align-items: center
}

.dropdown-menu.up-menu .up-avatar {
	width: 56px;
	height: 56px;
	border-radius: 50%;
	display: grid;
	place-items: center;
	background: linear-gradient(135deg, #4f46e5, #22c55e);
	color: #fff;
	font-weight: 800;
	font-size: 20px;
	box-shadow: 0 6px 14px rgba(0, 0, 0, .15);
	flex-shrink: 0
}

.dropdown-menu.up-menu .up-name {
	font-weight: 800;
	font-size: 16px;
	line-height: 1.15
}

.dropdown-menu.up-menu .up-dept {
	color: #6b7280;
	font-size: 12px;
	margin-top: 2px
}

.dropdown-menu.up-menu .up-badges {
	margin-top: 8px;
	display: flex;
	gap: 6px;
	flex-wrap: wrap
}

.dropdown-menu.up-menu .up-badge {
	font-size: 11px;
	padding: 4px 8px;
	border-radius: 999px;
	border: 1px solid #e5e7eb;
	background: #f8fafc;
	color: #334155
}

.dropdown-menu.up-menu .up-divide {
	height: 1px;
	background: #e5e7eb;
	margin: 12px -14px;
	border: 0
}

.dropdown-menu.up-menu .up-list {
	display: flex;
	flex-direction: column;
	gap: 6px;
	padding: 2px 0
}

.dropdown-menu.up-menu .up-item {
	display: flex;
	justify-content: space-between;
	gap: 12px
}

.dropdown-menu.up-menu .up-label {
	color: #6b7280;
	font-size: 12px
}

.dropdown-menu.up-menu .up-value {
	font-weight: 600;
	font-size: 13px
}

.dropdown-menu.up-menu .up-actions {
	display: flex;
	gap: 8px;
	margin-top: 10px
}

.dropdown-menu.up-menu .up-btn {
	flex: 1;
	height: 36px;
	border-radius: 10px;
	font-weight: 700;
	display: flex;
	align-items: center;
	justify-content: center;
	text-decoration: none
}

.dropdown-menu.up-menu .up-btn--ghost {
	border: 1px solid #e5e7eb;
	background: #fff;
	color: #111827
}

.dropdown-menu.up-menu .up-btn--primary {
	background: #4f46e5;
	color: #fff;
	border: 1px solid #4f46e5
}

@media ( max-width :420px) {
	.dropdown-menu.up-menu {
		min-width: 240px
	}
}
</style></li>
			</ul>
		</nav>

		<form id="logoutForm" action="/logout" method="post"
			style="display: none;">
			<input type="hidden" th:name="${_csrf.parameterName}"
				th:value="${_csrf.token}" />
		</form>
	</div>
</body>
</html>
