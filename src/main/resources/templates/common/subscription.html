<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>구독 신청</title>
  <!-- 아이콘 & 폰트 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/static/woff2/SUIT.css" rel="stylesheet">
  <style>
    body {
      font-family: 'SUIT', sans-serif;
      background: #f4f6fa;
      padding-top: 40px;
      overflow-x: hidden; /* 좌우 슬라이드 시 가로 스크롤 방지 */
    }
    .container {
      width: 1050px;
      margin: 60px auto;
      border: 1px solid #ddd;
      border-radius: 8px;
      background: #fff;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      padding: 20px;
      position: relative;
      /* 높이 고정 제거! 페이지 높이는 아래 .pages-wrapper가 책임짐 */
      overflow-x: hidden; /* 가로만 숨김 */
    }

    /* 단계 표시 */
    .stepper > div {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .stepper {
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }
    .circle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #ccc;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 6px; /* 라벨과 간격 */
      color: #fff;
      font-weight: bold;
      transition: all 0.3s;
    }
    .circle.active {
      background: linear-gradient(145deg, #8a6cf7, #4a2fbf);
      box-shadow: 0 3px 6px rgba(0,0,0,0.2);
    }
    .line {
      width: 250px;            /* 선 길이 고정 */
      height: 2px;
      background: #999;
      margin-top: 20px;        /* 원 중앙 맞춤 */
      flex: 0 0 auto;          /* flex 확장 금지 */
    }
    .step-label { margin-top: 5px; font-size: 13px; }

    /* 페이지 래퍼: 높이를 JS로 유동 조절 */
	.pages-wrapper {
	  position: relative;
	  width: 100%;
	  overflow: hidden;
	  transition: height 0.3s ease; /* 추가 */
	}

    /* 페이지 (좌우 슬라이드) */
    .page {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      transform: translateX(100%);        /* 기본은 오른쪽 대기 */
      transition: transform 0.5s ease-in-out;
      will-change: transform;
    }
    .page.active { transform: translateX(0); }
    .page.hidden-left  { transform: translateX(-100%); }
    .page.hidden-right { transform: translateX(100%); }

    /* 본문 */
    .form-sections { display: flex; }
    .section.sub-info {
      flex: 1.3;
      border-right: 1px solid #eee;
      padding: 20px;
      background: #fafafa;
    }
    .section.user-info {
      flex: 2;
      padding: 20px;
    }
    .section h3 {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 15px;
      padding-bottom: 6px;
      border-bottom: 2px solid #6a4fbf;
    }
    .section h4 { margin-top: 35px; margin-bottom: 10px; font-size: 15px; }

    /* 포함 서비스 */
    .services { margin-top: 15px; }
    .service {
      display: flex;
      align-items: center;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 10px 14px;
      margin: 10px 0;
      font-size: 14px;
      justify-content: space-between;
      background: #fff;
      transition: all 0.2s ease;
    }
    .service:hover { background: #f3f6ff; }
    .service:hover i { color: #4a2fbf; }     /* 오른쪽 아이콘 색 강조 */
    .service:hover .service-icon { background: #28a745; } /* 체크 원 더 진하게 */

    .service-icon {
      width: 20px; height: 20px;
      background: #19cc66;
      border-radius: 50%;
      display: flex; justify-content: center; align-items: center;
      color: #fff; font-size: 14px;
    }

    /* 사용자 입력 */
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px 20px;
    }
    .form-group { display: flex; flex-direction: column; }
    .form-group label { font-size: 13px; margin-bottom: 4px; }
    .form-group input, .form-group select {
      padding: 7px; border: 1px solid #999; border-radius: 2px; font-size: 13px;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    .form-group.full { grid-column: 1 / span 2; }
    .form-group input:focus, .form-group select:focus {
      border: 1px solid #6a4fbf; outline: none;
      box-shadow: 0 0 4px rgba(106, 79, 191, 0.4);
    }
    .email-input { display: flex; align-items: center; gap: 6px; }
    .email-input input { flex: 1; }
    .email-input select { min-width: 200px; padding: 7px; }

    /* 아코디언 (STEP2) */
    .accordion {
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-bottom: 20px;
      overflow: hidden;
      background: #fff;
    }
    .accordion-item { border-bottom: 1px solid #eee; }
    .accordion-item:last-child { border-bottom: none; }
    .accordion-header {
      width: 100%;
      text-align: left;
      padding: 12px 15px;
      background: #f9f9f9;
      border: none;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .accordion-header i { transition: transform 0.25s ease; }
    .accordion-header.active i { transform: rotate(180deg); }
	.accordion-content {
	  height: 0;
	  overflow: hidden;
	  transition: height 0.3s ease;
	}
	.accordion-content.open {
	  height: auto; /* JS에서 scrollHeight로 덮어씀 */
	}
    .accordion-content p { margin: 0 0 10px; }

    /* 전자서명 영역 */
    .agreement-box {
      background: #f5f5f5;
      padding: 20px;
      border-radius: 6px;
      margin-top: 15px;
      display: flex;
      gap: 20px;
      align-items: flex-start;
    }
    .agreement-left {
      flex: 1;
      font-size: 14px;
      line-height: 1.6;
      margin-top: 30px;
    }
    .agreement-right {
      flex: 1.2;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    #signaturePad {
      border: 1px solid #aaa;
      border-radius: 4px;
      background: #fff;
      cursor: crosshair;
      width: 100%;
      height: auto; /* width=500 height=200 비율 유지 */
    }
    .sign-actions {
      display: flex;
      gap: 10px;
    }
    .sign-actions button {
      padding: 8px 14px;
      font-size: 14px;
      border: 1px solid #aaa;
      background: #eee;
      cursor: pointer;
      border-radius: 4px;
    }
    .sign-actions button:hover {
      background: #ddd;
    }

    /* 버튼 */
    .form-footer {
      margin-top: 20px;
      display: flex; justify-content: space-between; gap: 10px;
    }
    .btn {
      flex: 1; padding: 14px; font-size: 16px; font-weight: bold;
      border: none; cursor: pointer; transition: all 0.3s;
      position: relative;
    }
    .btn-prev { background: #f9c9c9; }
    .btn-next { background: #c4d9f7; }
    .btn i { position: absolute; top: 50%; transform: translateY(-50%); }
    .btn-prev i { left: 20px; }
    .btn-next i { right: 20px; }
    .btn:hover { opacity: 0.9; }

    .biz-inputs, .phone-inputs {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .biz-inputs input, .phone-inputs input {
      width: 70px;
      padding: 6px;
      border: 1px solid #999;
      border-radius: 2px;
      font-size: 13px;
      text-align: center;
    }
    .error-msg {
      color: red;
      font-size: 12px;
      margin-top: 4px;
      min-height: 16px;     /* ← 항상 공간 확보 */
      visibility: hidden;   /* 안 보이게 */
    }
    .error-msg.active {
      visibility: visible;  /* 에러 있을 때만 보이게 */
    }
    /* 결제 수단 버튼 */
	.pay-methods {
	  display: flex;
	  gap: 10px;
	  margin-top: 10px;
	}
	.pay-btn {
	  flex: 1;
	  padding: 10px;
	  font-weight: bold;
	  border: none;
	  border-radius: 4px;
	  cursor: pointer;
	}
	.pay-btn.kakao { background: #ffeb00; color: #000; }
	.pay-btn.naver { background: #03c75a; color: #fff; }
	
	/* 결제 요약 테이블 */
	.summary-table {
	  width: 100%;
	  border-collapse: collapse;
	  margin-top: 10px;
	  font-size: 14px;
	}
	.summary-table td {
	  padding: 6px 0;
	}
	.summary-table .right {
	  text-align: right;
	}
	.summary-table .total td {
	  border-top: 2px solid #000;
	  padding-top: 8px;
	  font-size: 15px;
	}
	.agree-box {
	  margin-top: 15px;
	  font-size: 13px;
	}
    .pay-btn.active {
	  outline: 3px solid #333;
	}
	
  </style>
</head>
<body>
  <div class="container">
    <!-- 단계 표시 -->
    <div class="stepper">
      <div style="text-align:center">
        <div class="circle step-circle active" data-step="1">1</div>
        <div class="step-label">구독 정보</div>
      </div>
      <div class="line"></div>
      <div style="text-align:center">
        <div class="circle step-circle" data-step="2">2</div>
        <div class="step-label">계약서</div>
      </div>
      <div class="line"></div>
      <div style="text-align:center">
        <div class="circle step-circle" data-step="3">3</div>
        <div class="step-label">결제</div>
      </div>
    </div>

    <!-- 페이지 -->
    <div class="pages-wrapper" id="pagesWrapper">
      <!-- STEP 1 -->
      <div class="page active" id="step1">
        <div class="form-sections">
          <div class="section sub-info">
            <h3>구독 정보</h3>
            <p><strong>(월 ₩30,000) VAT 별도</strong></p>
            <h4>포함 서비스</h4>
            <div class="services">
              <div class="service"><span><div class="service-icon">✔</div> 회계</span> <i class="fa-regular fa-file-lines"></i></div>
              <div class="service"><span><div class="service-icon">✔</div> 인사</span> <i class="fa-solid fa-user"></i></div>
              <div class="service"><span><div class="service-icon">✔</div> 영업</span> <i class="fa-solid fa-chart-line"></i></div>
            </div>
          </div>
          <div class="section user-info">
            <h3>사용자 정보</h3>
            <form>
              <div class="form-grid">
                <div class="form-group">
                  <label>회사명</label>
                  <input type="text" id="companyName" placeholder="예) OO주식회사" required>
                  <span class="error-msg"></span>
                </div>
                <div class="form-group">
                  <label>대표자명</label>
                  <input type="text" id="ceoName" placeholder="예) 홍길동" required>
                  <span class="error-msg"></span>
                </div>
                <div class="form-group">
                  <label>사업자 등록번호</label>
                  <div class="biz-inputs">
                    <input type="text" id="biz1" maxlength="3" required> -
                    <input type="text" id="biz2" maxlength="2" required> -
                    <input type="text" id="biz3" maxlength="5" required>
                  </div>
                  <span class="error-msg"></span>
                </div>
                <div class="form-group">
                  <label>주소</label>
                  <input type="text" id="address" placeholder="도로명 주소" required>
                  <span class="error-msg"></span>
                </div>
                <div class="form-group">
                  <label>마스터 사용자 ID</label>
                  <input type="text" id="masterId" placeholder="관리자 계정 ID" required>
                  <span class="error-msg"></span>
                </div>
                <div class="form-group">
                  <label>마스터 PW</label>
                  <input type="password" id="masterPw" placeholder="초기 비밀번호" required>
                  <span class="error-msg"></span>
                </div>
                <div class="form-group">
                  <label>담당자명</label>
                  <input type="text" id="managerName" placeholder="예) 김길동" required>
                  <span class="error-msg"></span>
                </div>
                <div class="form-group">
                  <label>담당자 연락처</label>
                  <div class="phone-inputs">
                    <input type="text" id="phone1" maxlength="3" required> -
                    <input type="text" id="phone2" maxlength="4" required> -
                    <input type="text" id="phone3" maxlength="4" required>
                  </div>
                  <span class="error-msg"></span>
                </div>
                <div class="form-group full">
                  <label>담당자 이메일</label>
                  <div class="email-input">
                    <input type="text" id="emailFront" placeholder="example" required>
                    <span>@</span>
                    <select id="emailDomain" required>
                      <option value="">선택</option>
                      <option value="gmail.com">gmail.com</option>
                      <option value="naver.com">naver.com</option>
                      <option value="daum.net">daum.net</option>
                      <option value="company.com">company.com</option>
                    </select>
                  </div>
                  <span class="error-msg"></span>
                </div>
                <div class="form-group full">
                  <label>구독 기간</label>
                  <select id="subPeriod" required>
                    <option value="">선택</option>
                    <option>1개월</option>
                    <option>3개월</option>
                    <option>6개월</option>
                    <option>12개월</option>
                  </select>
                  <span class="error-msg"></span>
                </div>
              </div>
            </form>
          </div>
        </div>
        <div class="form-footer">
			<button class="btn btn-prev" onclick="location.href='/'">
			  <i class="fa fa-arrow-left"></i> 이전으로
			</button>
          <button class="btn btn-next" onclick="goToStep(2)">
            다음으로 <i class="fa fa-arrow-right"></i>
          </button>
        </div>
      </div>

      <!-- STEP 2 -->
      <div class="page hidden-right" id="step2">
        <div class="section">
          <h3>ERP 시스템 이용계약서</h3>

          <!-- 아코디언 -->
          <div class="accordion">
            <div class="accordion-item">
              <button class="accordion-header">
                [ 서비스 이용 계약서 ]
                <i class="fa fa-chevron-down"></i>
              </button>
              <div class="accordion-content">
                <p><strong>제1조 (목적)</strong><br>
                본 계약은 [회사명]이 제공하는 ERP 시스템(이하 "서비스")의 이용과 관련하여, 서비스 제공자와 이용자 간의 권리와 의무 및 책임사항을 규정함을 목적으로 합니다.</p>

                <p><strong>제2조 (서비스 범위)</strong><br>
                1. 서비스 제공자는 ERP 시스템의 회계, 인사, 영업 관련 기능을 제공합니다.<br>
                2. 서비스의 구체적인 내용과 범위는 회사의 정책에 따라 변경될 수 있습니다.</p>

                <p><strong>제3조 (이용자의 의무)</strong><br>
                1. 이용자는 서비스를 본래의 목적에 맞게 사용해야 합니다.<br>
                2. 불법적인 용도로 서비스를 이용하거나, 타인의 권리를 침해해서는 안 됩니다.</p>

                <p><strong>제4조 (계약 기간 및 해지)</strong><br>
                1. 기본 계약 기간은 구독 신청 시 선택한 기간으로 합니다.<br>
                2. 이용자는 계약기간 중 해지를 원할 경우 회사가 정한 절차에 따라 해지 신청을 해야 하며, 이미 납부한 요금은 환불되지 않습니다.</p>

                <p><strong>제5조 (책임 제한)</strong><br>
                회사는 천재지변, 시스템 장애, 외부 요인으로 인한 서비스 중단에 대하여 책임을 지지 않습니다. 단, 회사의 고의 또는 중대한 과실로 인한 경우에는 예외로 합니다.</p>
              </div>
            </div>

            <div class="accordion-item">
              <button class="accordion-header">
                [ 개인정보 수집 · 이용 동의서 ]
                <i class="fa fa-chevron-down"></i>
              </button>
              <div class="accordion-content">
                <p><strong>1. 수집하는 개인정보 항목</strong><br>
                - 회사명, 대표자명, 사업자 등록번호, 담당자명, 연락처, 이메일 주소</p>

                <p><strong>2. 개인정보의 수집 및 이용 목적</strong><br>
                1) 서비스 가입 및 관리<br>
                2) 계약 이행 및 서비스 제공<br>
                3) 요금 청구 및 결제 관리<br>
                4) 고객 상담 및 공지사항 전달</p>

                <p><strong>3. 개인정보의 보관 및 이용 기간</strong><br>
                수집된 개인정보는 서비스 이용 계약이 유지되는 동안 보관하며, 계약 해지 시 즉시 파기합니다.<br>
                단, 관련 법령에 따라 일정 기간 보관이 필요한 경우 해당 기간 동안 보관할 수 있습니다.</p>

                <p><strong>4. 동의 거부 권리</strong><br>
                이용자는 개인정보 수집 및 이용에 대한 동의를 거부할 권리가 있으며, 동의 거부 시 서비스 이용이 제한될 수 있습니다.</p>
              </div>
            </div>
          </div>

          <!-- 계약 동의/서명 -->
          <div class="agreement-box">
            <div class="agreement-left">
              <p>본 계약서의 모든 내용을 확인하였으며, 이에 동의합니다.</p>
              <p>계약일자 : <strong id="contractDate"></strong></p>
              <p>구독 회사명 : <span id="contractCompany">__________</span></p>
              <p>대표자명 : <span id="contractCeo">__________</span></p>
              <p>계약 만료일자 : <strong id="contractEndDate">__________</strong></p>
            </div>

            <div class="agreement-right">
              <label>전자서명</label>
              <canvas id="signaturePad" width="500" height="200"></canvas>
              <div class="sign-actions">
                <button type="button" id="clearSign">초기화</button>
              </div>
            </div>
          </div>

          <div class="form-footer">
            <button class="btn btn-prev" onclick="goToStep(1)">
              <i class="fa fa-arrow-left"></i> 이전으로
            </button>
            <button class="btn btn-next" onclick="goToStep(3)">
              다음으로 <i class="fa fa-arrow-right"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- STEP 3 -->
      <!-- STEP 3 -->
<div class="page hidden-right" id="step3">
  <div class="form-sections">
    
    <!-- 결제 정보 -->
    <div class="section sub-info">
      <h3>결제 정보</h3>


      <h4>간편 결제 수단</h4>
      <div class="pay-methods">
		<button type="button" class="pay-btn kakao" onclick="selectPayMethod('kakao')">카카오 페이</button>
  		<button type="button" class="pay-btn naver" onclick="selectPayMethod('naver')">네이버 페이</button>
      </div>
    </div>

    <!-- 최종 결제 내역 -->
	<div class="section user-info">
	  <h3>최종 결제 내역</h3>
	  <div class="summary">
	    <p><strong>ERP</strong></p>
	    <p id="summaryPeriod">___개월 구독 / 월 ₩30,000</p>
	    <table class="summary-table">
	      <tr>
	        <td>기본 요금</td>
	        <td class="right" id="summaryBase">₩0</td>
	      </tr>
	      <tr>
	        <td>부가세</td>
	        <td class="right" id="summaryTax">₩0</td>
	      </tr>
	      <tr class="total">
	        <td><strong>총 결제 금액</strong></td>
	        <td class="right" id="summaryTotal"><strong>₩0</strong></td>
	      </tr>
	    </table>
	  </div>
	  <div class="agree-box">
	    <label><input type="checkbox" id="agreePayment"> 위 결제 금액에 동의합니다.</label>
	  </div>
	</div>
  </div>
	
	  <!-- 하단 버튼 -->
	  <div class="form-footer">
	    <button class="btn btn-prev" onclick="goToStep(2)">
	      <i class="fa fa-arrow-left"></i> 이전으로
	    </button>
	    <button class="btn btn-next" onclick="submitPayment()">
	      결제하기 <i class="fa fa-arrow-right"></i>
	    </button>
	  </div>
	</div>

    </div>
  </div>

<script>
  let currentStep = 1;

  	// 활성 페이지 높이에 맞춰 래퍼 높이 조정 (초기/전환/리사이즈/아코디언/에러 때 호출)
	function resizeWrapper() {
	  const wrapper = document.getElementById('pagesWrapper');
	  const activePage = document.querySelector('.page.active');
	  if (!wrapper || !activePage) return;
	  wrapper.style.height = activePage.scrollHeight + 'px'; // 즉시 최종 높이로
	}


  // 숫자만 입력
  function onlyNumberInput(selector) {
    document.querySelectorAll(selector).forEach(input => {
      input.addEventListener("input", () => {
        input.value = input.value.replace(/\D/g, ""); // 숫자 이외 제거
      });
    });
  }

  // 자동 포커스 이동
  function autoMoveNext(selector) {
    document.querySelectorAll(selector).forEach(input => {
      input.addEventListener("input", () => {
        const maxLength = input.getAttribute("maxlength");
        if (maxLength && input.value.length >= maxLength) {
          let next = input.nextElementSibling;
          while (next && next.tagName !== "INPUT") {
            next = next.nextElementSibling;
          }
          if (next) next.focus();
        }
      });
    });
  }

  // 에러 메시지 표시/초기화
  function showError(input, message) {
    const container = input.closest(".form-group");
    const errorSpan = container.querySelector(".error-msg");
    if (errorSpan) {
      errorSpan.textContent = message;
      errorSpan.classList.add("active");
    }
    input.focus();
    requestAnimationFrame(resizeWrapper); // 에러로 높이 변했을 때 맞춤
  }

  function clearErrors() {
    document.querySelectorAll(".error-msg").forEach(span => {
      span.textContent = "";
      span.classList.remove("active");
    });
    requestAnimationFrame(resizeWrapper);
  }

  // STEP1 검증
  function validateStep1() {
    clearErrors();

    const companyName = document.getElementById("companyName");
    const ceoName = document.getElementById("ceoName");
    const biz1 = document.getElementById("biz1");
    const biz2 = document.getElementById("biz2");
    const biz3 = document.getElementById("biz3");
    const address = document.getElementById("address");
    const masterId = document.getElementById("masterId");
    const masterPw = document.getElementById("masterPw");
    const managerName = document.getElementById("managerName");
    const phone1 = document.getElementById("phone1");
    const phone2 = document.getElementById("phone2");
    const phone3 = document.getElementById("phone3");
    const emailFront = document.getElementById("emailFront");
    const emailDomain = document.getElementById("emailDomain");
    const subPeriod = document.getElementById("subPeriod");

    if (!companyName.value.trim()) { showError(companyName, "회사명을 입력해주세요."); return false; }
    if (!ceoName.value.trim()) { showError(ceoName, "대표자명을 입력해주세요."); return false; }
    if (!biz1.value.trim() || !biz2.value.trim() || !biz3.value.trim()) { showError(biz1, "사업자 등록번호를 모두 입력해주세요."); return false; }
    if (!address.value.trim()) { showError(address, "주소를 입력해주세요."); return false; }
    if (!masterId.value.trim()) { showError(masterId, "마스터 사용자 ID를 입력해주세요."); return false; }
    if (!masterPw.value.trim()) { showError(masterPw, "마스터 PW를 입력해주세요."); return false; }
    if (!managerName.value.trim()) { showError(managerName, "담당자명을 입력해주세요."); return false; }
    if (!phone1.value.trim() || !phone2.value.trim() || !phone3.value.trim()) { showError(phone1, "연락처를 모두 입력해주세요."); return false; }
    if (!emailFront.value.trim()) { showError(emailFront, "이메일 앞부분을 입력해주세요."); return false; }
    if (!emailDomain.value.trim()) { showError(emailDomain, "이메일 도메인을 선택해주세요."); return false; }
    if (!subPeriod.value.trim()) { showError(subPeriod, "구독 기간을 선택해주세요."); return false; }

    // 사업자 등록번호 형식 검증 (3-2-5)
    const biz = `${biz1.value}-${biz2.value}-${biz3.value}`;
    if (!/^\d{3}-\d{2}-\d{5}$/.test(biz)) {
      showError(biz1, "사업자 등록번호 형식이 올바르지 않습니다. (예: 123-45-67890)");
      return false;
    }

    // 연락처 형식 검증 (2~3 - 3~4 - 4)
    const phone = `${phone1.value}-${phone2.value}-${phone3.value}`;
    if (!/^\d{2,3}-\d{3,4}-\d{4}$/.test(phone)) {
      showError(phone1, "연락처 형식이 올바르지 않습니다. (예: 010-1234-5678)");
      return false;
    }

    return true;
  }

  // STEP 이동
	function goToStep(step) {
	  if (step === currentStep) return;
	
	  // STEP1 → STEP2 이동 시 검증
	  if (currentStep === 1 && step === 2) {
	    if (!validateStep1()) return;
	  }
	
	  const currentPage = document.getElementById('step' + currentStep);
	  const nextPage = document.getElementById('step' + step);
	
	  if (step > currentStep) {
	    currentPage.classList.remove('active');
	    currentPage.classList.add('hidden-left');
	    nextPage.classList.remove('hidden-left','hidden-right');
	  } else {
	    currentPage.classList.remove('active');
	    currentPage.classList.add('hidden-right');
	    nextPage.classList.remove('hidden-right','hidden-left');
	  }
	  nextPage.classList.add('active');
	
	  document.querySelectorAll('.step-circle').forEach(c => {
	    c.classList.toggle('active', c.dataset.step == step);
	  });
	
	  currentStep = step;
	
	  // STEP2 들어갈 때 계약서 내용 채우기
	  if (step === 2) {
	    const company = document.getElementById("companyName").value || "__________";
	    const ceo = document.getElementById("ceoName").value || "__________";
	    const today = new Date();
	    const subPeriod = document.getElementById("subPeriod").value;
	
	    // 계약 시작일
	    const startDateStr = today.toISOString().split("T")[0];
	
	    // 계약 종료일 계산
	    let endDate = new Date(today);
	    if (subPeriod.includes("개월")) {
	      const months = parseInt(subPeriod.replace("개월", ""));
	      endDate.setMonth(endDate.getMonth() + months);
	    }
	    const endDateStr = endDate.toISOString().split("T")[0];
	
	    document.getElementById("contractCompany").textContent = "[ " + company + " ]";
	    document.getElementById("contractCeo").textContent = "[ " + ceo + " ]";
	    document.getElementById("contractDate").textContent = "[ " + startDateStr + " ]";
	    document.getElementById("contractEndDate").textContent = "[ " + endDateStr + " ]";
	 }

  // STEP3 들어갈 때 결제 내역 채우기
  if (step === 3) {
    const subPeriod = document.getElementById("subPeriod").value;
    let months = 0;
    if (subPeriod.includes("개월")) {
      months = parseInt(subPeriod.replace("개월", ""));
    }

    const unitPrice = 30000;
    const basePrice = months * unitPrice;
    const tax = Math.round(basePrice * 0.1);
    const total = basePrice + tax;

    document.getElementById("summaryPeriod").textContent = subPeriod + " 구독 / 월 ₩" + unitPrice.toLocaleString();
    document.getElementById("summaryBase").textContent = "₩" + basePrice.toLocaleString();
    document.getElementById("summaryTax").textContent = "₩" + tax.toLocaleString();
    document.getElementById("summaryTotal").textContent = "₩" + total.toLocaleString();
  }

  // 높이 재조정
  requestAnimationFrame(resizeWrapper);
  nextPage.addEventListener('transitionend', resizeWrapper, { once: true });
}


  function initAccordion() {
	  document.querySelectorAll('.accordion-header').forEach(header => {
	    header.addEventListener('click', () => {
	      const content = header.nextElementSibling;
	      header.classList.toggle('active');
	      content.classList.toggle('open');

	      // 클릭 즉시 한 번 조정
	      resizeWrapper();

	      // transition 끝난 뒤 최종 높이 다시 조정
	      content.addEventListener('transitionend', resizeWrapper, { once: true });
	    });
	  });
	}

  function resizeWrapper() {
	  const wrapper = document.getElementById('pagesWrapper');
	  const activePage = document.querySelector('.page.active');
	  if (!wrapper || !activePage) return;

	  wrapper.style.height = activePage.scrollHeight + 'px';
	}

  // 전자서명 (마우스 + 터치 지원, 좌표 보정)
  let canvas, ctx, drawing = false;
  function getPosition(e) {
    const rect = canvas.getBoundingClientRect();
    const scaleX = canvas.width / rect.width;
    const scaleY = canvas.height / rect.height;
    if (e.touches) {
      return {
        x: (e.touches[0].clientX - rect.left) * scaleX,
        y: (e.touches[0].clientY - rect.top) * scaleY
      };
    } else {
      return {
        x: (e.clientX - rect.left) * scaleX,
        y: (e.clientY - rect.top) * scaleY
      };
    }
  }
  function startDrawing(e) {
    e.preventDefault();
    drawing = true;
    const pos = getPosition(e);
    ctx.beginPath();
    ctx.moveTo(pos.x, pos.y);
  }
  function draw(e) {
    if (!drawing) return;
    e.preventDefault();
    const pos = getPosition(e);
    ctx.lineTo(pos.x, pos.y);
    ctx.strokeStyle = "#000";
    ctx.lineWidth = 2;
    ctx.lineCap = "round";
    ctx.stroke();
  }
  function stopDrawing(e) {
    if (!drawing) return;
    e.preventDefault();
    drawing = false;
  }

  // 초기 세팅
  document.addEventListener('DOMContentLoaded', () => {
    initAccordion();
    resizeWrapper();                // 첫 페이지 높이 맞춤
    window.addEventListener('resize', resizeWrapper);

    // 서명 패드 초기화
    canvas = document.getElementById("signaturePad");
    ctx = canvas.getContext("2d");
    canvas.addEventListener("mousedown", startDrawing);
    canvas.addEventListener("mousemove", draw);
    canvas.addEventListener("mouseup", stopDrawing);
    canvas.addEventListener("mouseleave", stopDrawing);
    canvas.addEventListener("touchstart", startDrawing, {passive:false});
    canvas.addEventListener("touchmove", draw, {passive:false});
    canvas.addEventListener("touchend", stopDrawing, {passive:false});
    canvas.addEventListener("touchcancel", stopDrawing, {passive:false});

    document.getElementById("clearSign").addEventListener("click", () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    });

    // 숫자 입력 제한 & 자동 포커스 이동
    onlyNumberInput("#biz1, #biz2, #biz3, #phone1, #phone2, #phone3");
    autoMoveNext("#biz1, #biz2, #biz3, #phone1, #phone2, #phone3");
  });

  // 폰트/아이콘 로드 완료 후 한 번 더 높이 보정 (초기 잘림 방지)
  window.addEventListener('load', resizeWrapper);
  
  function toggleAccordion(header) {
	  const content = header.nextElementSibling;
	  header.classList.toggle('active');
	  content.classList.toggle('open');

	  // 아코디언을 열거나 닫을 때 바로 최종 높이 계산
	  requestAnimationFrame(resizeWrapper);
	}

  let selectedMethod = null;

  function selectPayMethod(method) {
    selectedMethod = method;

    // 버튼 선택 효과
    document.querySelectorAll('.pay-btn').forEach(btn => btn.classList.remove('active'));
    const selectedBtn = document.querySelector('.pay-btn.' + method);
    if (selectedBtn) selectedBtn.classList.add('active');
  }

  function submitPayment() {
    if (!document.getElementById("agreePayment").checked) {
      alert("결제 금액에 동의해야 진행 가능합니다.");
      return;
    }
    if (!selectedMethod) {
      alert("결제 수단을 선택해주세요.");
      return;
    }

    const orderId = "ORDER_" + new Date().getTime();
    const userId = "admin01";
    const payRequest = {
      orderId: orderId,
      userId: userId,
      itemName: "ERP 구독",
      amount: parseInt(document.getElementById("summaryTotal").textContent.replace(/[₩,]/g, ""))
    };

    if (selectedMethod === "kakao") {
      // 카카오페이 API
      fetch("/pay/kakao/ready", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payRequest)
      })
      .then(res => res.json())
      .then(data => {
        window.location.href = data.next_redirect_pc_url;
      })
      .catch(err => console.error(err));
    } else if (selectedMethod === "naver") {
      // 네이버페이 API (예시)
      fetch("/pay/naver/ready", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payRequest)
      })
      .then(res => res.json())
      .then(data => {
        window.location.href = data.redirectUrl;
      })
      .catch(err => console.error(err));
    }
  }

</script>

</body>
</html>
