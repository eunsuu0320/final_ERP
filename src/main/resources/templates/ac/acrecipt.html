<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<head>
  <meta charset="UTF-8" />
  <title>ê±°ë˜ëª…ì„¸ì„œ</title>

  <style>
    /* ===== í˜ì´ì§€ ë ˆì´ì•„ì›ƒ(ëª©ë¡/ê²€ìƒ‰) ===== */
    .wrap{width:100%;max-width:1600px;margin:0 auto;padding:0 8px;}
    .section{margin:12px 0;}
    .searchline{display:flex;flex-wrap:wrap;align-items:flex-end;gap:10px;}
    .form-group{display:flex;flex-direction:column;gap:6px;}
    .form-label{font-size:.95rem;}
    .input-with-icon{display:flex;align-items:center;gap:6px;}
    .input-with-icon .form-control{width:220px;}
    .btn{height:38px;padding:0 .9rem;}
    .btn-icon{min-width:38px;}
    .actions-right{display:flex;justify-content:flex-end;gap:8px;}
    .table-wrap{position:relative;background:#fff;border:1px solid #e1e3e6;border-radius:8px;overflow:hidden;--grid-h: calc(72vh - 80px);}
    .tabulator{border:0;}
    .tabulator-header{border-bottom:1px solid #e1e3e6;}
    .tabulator-col{background:#f7f7f9;font-weight:700;}
    .tabulator-tableholder{max-height:var(--grid-h);}
    .loading-overlay{position:absolute;inset:0;display:none;align-items:center;justify-content:center;background:rgba(255,255,255,.55);backdrop-filter:blur(1px);z-index:50;}
    .loading-overlay.show{display:flex;}
    .loading-box{display:flex;align-items:center;gap:10px;padding:10px 14px;border-radius:10px;background:#fff;border:1px solid #e4e6eb;box-shadow:0 4px 18px rgba(0,0,0,.08);font-weight:600;color:#333;}
    .toast-min{position:fixed;right:24px;bottom:24px;background:#333;color:#fff;padding:10px 14px;border-radius:8px;opacity:.95;z-index:2000}

    /* ì¸ì‡„ ì»¬ëŸ¬ ë³´ì • */
    @media print{
      body{ -webkit-print-color-adjust:exact; print-color-adjust:exact; }
    }
  </style>
</head>

<body layout:fragment="content">
<div id="layoutSidenav_content">
  <main>
    <div class="wrap">
      <!-- ì œëª© -->
      <div class="section">
        <h1 class="mb-0">ê±°ë˜ëª…ì„¸ì„œ</h1>
      </div>

      <!-- ìš°ì¸¡ ìƒë‹¨ ë²„íŠ¼ -->
      <div class="section">
        <div class="actions-right">
          <!-- â­ ë°˜ë“œì‹œ type="button" -->
          <button id="btn-print" type="button" class="btn btn-dark">ì¸ì‡„</button>
        </div>
      </div>

      <!-- ê²€ìƒ‰ -->
      <div class="section">
        <div class="searchline">
          <div class="form-group">
            <label class="form-label" for="s-partner">ê±°ë˜ì²˜ëª…</label>
            <div class="input-with-icon">
              <input id="s-partner" type="text" class="form-control" placeholder="ê±°ë˜ì²˜ëª…">
              <button id="btn-find-partner" type="button" class="btn btn-outline-secondary btn-icon" title="ê±°ë˜ì²˜ ê²€ìƒ‰" aria-label="ê±°ë˜ì²˜ ê²€ìƒ‰">ğŸ”</button>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label" for="s-product">í’ˆëª©ëª…</label>
            <div class="input-with-icon">
              <input id="s-product" type="text" class="form-control" placeholder="í’ˆëª©ëª…">
              <button id="btn-find-product" type="button" class="btn btn-outline-secondary btn-icon" title="í’ˆëª© ê²€ìƒ‰" aria-label="í’ˆëª© ê²€ìƒ‰">ğŸ”</button>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">ì¼ì ë²”ìœ„</label>
            <div class="input-with-icon" style="gap:6px;">
              <input id="s-from" type="date" class="form-control">
              <span style="align-self:center;color:#6b7280;">~</span>
              <input id="s-to" type="date" class="form-control">
              <!-- â­ ë°˜ë“œì‹œ type="button" -->
              <button id="btn-search" type="button" class="btn btn-warning">ê²€ìƒ‰</button>
              <button id="btn-reset"  type="button" class="btn btn-outline-secondary">ì´ˆê¸°í™”</button>
            </div>
          </div>
        </div>
      </div>

      <!-- ëª©ë¡ -->
      <div class="box">
        <div class="table-wrap">
          <div id="acrecipt-grid"></div>
          <div id="tbl-loading" class="loading-overlay" aria-hidden="true">
            <div class="loading-box">
              <div class="spinner-border" role="status" aria-label="loading"></div>
              <span>ë°ì´í„° ë¡œë”© ì¤‘â€¦</span>
            </div>
          </div>
        </div>
      </div>

    </div>
  </main>
</div>

<!-- ê³µí†µ ëª¨ë‹¬ fragment (openModal/Tabulator í¬í•¨) -->
<div th:replace="common/modal :: commonModal"></div>

<script>
(() => {
  /* ===== ìœ í‹¸ ===== */
  const $  = (s, r=document) => r.querySelector(s);
  const fmt = (n) => Number(n||0).toLocaleString();
  const toast=(m,ms=1600)=>{const t=document.createElement('div');t.className='toast-min';t.textContent=m;document.body.appendChild(t);setTimeout(()=>t.remove(),ms);};
  const todayStr=()=>new Date().toISOString().slice(0,10);

  /* í•œê¸€ ê¸ˆì•¡í‘œê¸°(ì •ì‹) */
  function numberToKoreanFormal(n){
    n = Number(n||0);
    if (!n) return 'ì˜ì›';
    const num = ['','ì¼','ì´','ì‚¼','ì‚¬','ì˜¤','ìœ¡','ì¹ ','íŒ”','êµ¬'];
    const unit1 = ['','ì‹­','ë°±','ì²œ'];
    const unit2 = ['','ë§Œ','ì–µ','ì¡°','ê²½'];
    let s = '', i2 = 0;
    while(n>0){
      let part = n % 10000, chunk = '';
      for(let i=0;i<4;i++){
        const d = part % 10;
        if (d){ const dt = (i>0 && d===1) ? '' : num[d]; chunk = dt + unit1[i] + chunk; }
        part = Math.floor(part/10);
      }
      if (chunk) s = chunk + unit2[i2] + (s? ' '+s:'');
      n = Math.floor(n/10000); i2++;
    }
    return s + 'ì›';
  }

  /* ===== í‚¤ ì •ê·œí™” & ì•ˆì „ ë§¤í•‘ ===== */
  const normKey = k => String(k||'').replace(/[^a-z0-9]/gi,'').toLowerCase();
  function toNormMap(obj){ const m={}; for(const [k,v] of Object.entries(obj||{})){ m[normKey(k)] = v; } return m; }
  function pickVal(obj, candidates, def=''){
    const nm = toNormMap(obj);
    for(const c of candidates){ const key = normKey(c); if (key in nm && nm[key]!=null) return nm[key]; }
    return def;
  }

  /* ë‚ ì§œ ê¸°ë³¸ */
  function initDates(){ $('#s-from').value = ''; $('#s-to').value = ''; }

  /* ë¡œë”© ì˜¤ë²„ë ˆì´ */
  const $overlay = $('#tbl-loading');
  const showLoading = ()=> $overlay?.classList.add('show');
  const hideLoading = ()=> $overlay?.classList.remove('show');

  /* ===== Tabulator ===== */
  let allSelected=false;
  const grid = new Tabulator("#acrecipt-grid", {
    height:"100%",
    layout:"fitColumns",
    pagination:true,
    paginationMode:"local",
    paginationSize:19,
    selectable:true,
    selectableRangeMode:"drag",
    columns:[
      {
        titleFormatter:"rowSelection",
        formatter:"rowSelection",
        width:55, headerSort:false,
        hozAlign:"center", headerHozAlign:"center",
        titleFormatterParams:{ rowRange:"active" },
        headerClick:()=>{ if(!allSelected){ grid.selectRow("visible"); } else { grid.deselectRow(); } allSelected=!allSelected; }
      },
      { title:"ê±°ë˜ì²˜ëª…", field:"partnerName", minWidth:180 },
      { title:"í’ˆëª©ëª…",   field:"productName", minWidth:220 },
      { title:"ìˆ˜ëŸ‰",     field:"qty",         minWidth:90, hozAlign:"right", formatter:(c)=>fmt(c.getValue()) },
      { title:"ê¸ˆì•¡",     field:"amountSupply", minWidth:120, hozAlign:"right", formatter:(c)=>fmt(c.getValue()) },
      { title:"ë¶€ê°€ì„¸",   field:"amountVat",    minWidth:110, hozAlign:"right", formatter:(c)=>fmt(c.getValue()) },
      { title:"ì´ ê¸ˆì•¡",  field:"amountTotal",  minWidth:130, hozAlign:"right", formatter:(c)=>fmt(c.getValue()) },
      { title:"íŒë§¤ì¼ì", field:"salesDate",    width:120, hozAlign:"center",
        formatter:(c)=>{ const v=c.getValue(); if(!v) return ""; const d=new Date(v); return isNaN(d)?String(v).slice(0,10):d.toISOString().slice(0,10);} },
    ],
    initialSort:[{column:"salesDate", dir:"desc"}],
  });

  /* ===== ê²€ìƒ‰ ===== */
  async function search(){
    const partner = $('#s-partner').value?.trim() || '';
    const product = $('#s-product').value?.trim() || '';
    const from    = $('#s-from').value || '';
    const to      = $('#s-to').value || '';

    // ì„œë²„ê°€ ì–´ë–¤ íŒŒë¼ë¯¸í„°ëª…ì„ ì“°ë“  ë§ì¶°ì£¼ê¸° ìœ„í•´ ì—¬ëŸ¬ í‚¤ë¡œ ì „ì†¡
    const qs = new URLSearchParams({ partnerName: partner, from, to });
    if (product){
      qs.append('productName', product);
      qs.append('product', product);
      qs.append('product_name', product);
    }

    // ê³µí†µ í‚¤ ë°°ì—´ (í´ë¼ì´ì–¸íŠ¸ ë³´ì • í•„í„°/ë§¤í•‘ì— ì‚¬ìš©)
    const kPartner  = ['partnerName','customerName','clientName','buyerName','supplierName','partner'];
    const kProduct  = ['productName','product_name','PRODUCT_NAME','itemName','item','goodsName','goods','prodName','PRODUCT'];
    const kQty      = ['qty','quantity','salesQty','SALES_QTY','orderQty','QTY'];
    const kSupply   = ['amountSupply','supply','price','AMOUNT_SUPPLY','supplyAmount'];
    const kVat      = ['amountVat','vat','tax','AMOUNT_VAT'];
    const kTotal    = ['amountTotal','total','TOTAL','sum','grandTotal'];
    const kDate     = ['salesDate','date','saleDate','SALES_DATE'];
    const kUnit     = ['unit','unitName','uom','UNIT','UNIT_NAME'];

    let data=[];
    showLoading();
    try{
      const res  = await fetch(`/api/acrecipt?${qs.toString()}`, { headers:{'Accept':'application/json'} });
      const text = await res.text();
      if(!res.ok) throw new Error(text || 'search failed');
      const j = text ? JSON.parse(text) : [];
      data = Array.isArray(j) ? j : (j.content||[]);
    }catch(e){
      console.error('[ACRECIPT] fetch failed', e);
      toast('ì¡°íšŒ ì‹¤íŒ¨: ' + (e.message||'')); data=[];
    } finally {
      hideLoading();
    }

    // âœ… ì„œë²„ í•„í„°ê°€ ë™ì‘í•˜ì§€ ì•ŠëŠ” ê²½ìš°ë¥¼ ëŒ€ë¹„í•œ í´ë¼ì´ì–¸íŠ¸ ë³´ì • í•„í„°
    if (product){
      const kw = product.toLowerCase();
      data = (data||[]).filter(r => {
        const p = String(pickVal(r, kProduct, '')||'').toLowerCase();
        return p.includes(kw);
      });
    }

    const rows = (data||[]).map((r, idx)=>{
      const supply = Number(pickVal(r,kSupply,0))||0;
      const vat    = Number(pickVal(r,kVat,0))||0;
      let total    = Number(pickVal(r,kTotal, supply+vat))||0;
      if (!total && (supply||vat)) total = supply + vat;

      return {
        id:           r.id ?? r.ID ?? idx+1,
        partnerName:  String(pickVal(r,kPartner,'')),
        productName:  String(pickVal(r,kProduct,'')),
        qty:          Number(pickVal(r,kQty,0))||0,
        unit:         String(pickVal(r,kUnit,'')),
        amountSupply: supply,
        amountVat:    vat,
        amountTotal:  total,
        salesDate:    String(pickVal(r,kDate,'')).slice(0,10),
      };
    });

    await grid.setData(rows);
    grid.setPage(1);
  }

  /* ì´ˆê¸°í™” */
  function resetForm(){
    $('#s-partner').value=''; $('#s-product').value='';
    initDates();
    grid.clearData();
    search();
  }

  /* íšŒì‚¬ì •ë³´ */
  async function fetchCompany(){
    try{
      const r = await fetch('/api/company/profile', { headers:{'Accept':'application/json'} });
      if(!r.ok) throw 0;
      const j = await r.json();
      return {
        name: j?.name || j?.companyName || '(ì‚¬)ê³¼í•™ì—°êµ¬íšŒ å…ä¸­',
        bizNo: j?.bizNo || j?.businessNumber || '220-12-34567',
        tel:  j?.tel   || j?.phone || '1586-5333',
        ceo:  j?.ceo   || j?.owner || 'ê¹€ì‹¤ë¡€',
        addr: j?.address || 'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë™êµ¬ ê³ ë•ë¹„ì¦ˆë°¸ë¦¬ë¡œ6ê¸¸ 84 (ê³ ë•ë™) (ì£¼)ì´ì¹´ìš´íŠ¸'
      };
    }catch(_){
      return { name:'(ì‚¬)ê³¼í•™ì—°êµ¬íšŒ å…ä¸­', bizNo:'220-12-34567', tel:'1586-5333', ceo:'ê¹€ì‹¤ë¡€',
               addr:'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë™êµ¬ ê³ ë•ë¹„ì¦ˆë°¸ë¦¬ë¡œ6ê¸¸ 84 (ê³ ë•ë™) (ì£¼)ì´ì¹´ìš´íŠ¸' };
    }
  }

  /* ===== ì¸ì‡„(ê°™ì€ ê±°ë˜ì²˜ë§Œ í—ˆìš©) ===== */
  function openPrintWindow(rowsForOnePartner, company){
    const partnerName = rowsForOnePartner[0]?.partnerName || '';
    const totalSupply = rowsForOnePartner.reduce((a,b)=>a+(+b.amountSupply||0),0);
    const totalVat    = rowsForOnePartner.reduce((a,b)=>a+(+b.amountVat||0),0);
    const total       = totalSupply + totalVat;
    const sumQty      = rowsForOnePartner.reduce((a,b)=>a+(+b.qty||0),0);

    const rowsHtml = rowsForOnePartner.map(r=>{
      const unitPrice = (r.qty ? Math.round((+r.amountSupply||0) / r.qty) : 0);
      const dt = (r.salesDate||'').slice(5).replace('-','/');
      const qtyWithUnit = `${Number(r.qty||0).toLocaleString()}${r.unit ? ' ' + r.unit : ''}`;
      return `
        <tr>
          <td class="c">${dt}</td>
          <td class="l">${r.productName||''}</td>
          <td class="c">${qtyWithUnit}</td>
          <td class="num">${unitPrice.toLocaleString()}</td>
          <td class="num">${(+r.amountSupply||0).toLocaleString()}</td>
          <td class="num">${(+r.amountVat||0).toLocaleString()}</td>
          <td class="num">${((+r.amountTotal || ((+r.amountSupply||0)+(+r.amountVat||0)))).toLocaleString()}</td>
        </tr>`;
    }).join('');

    const filler = Array(Math.max(0, 9 - rowsForOnePartner.length)).fill(
      '<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td><td></td><td></td></tr>'
    ).join('');

    const korAmt = numberToKoreanFormal(total).replace(/ì›$/, 'ì› ì •');
    const today = todayStr().replaceAll('-','/');
    const titleText = partnerName || company.name || '';

    const html = `<!DOCTYPE html>
<html lang="ko"><head><meta charset="UTF-8">
<title>ê±°ë˜ëª…ì„¸ì„œ</title>
<style>
  @page{ size:A4; margin:10mm 12mm; }
  *{ box-sizing:border-box; }
  body{ font-family:"Malgun Gothic","Apple SD Gothic Neo",sans-serif; color:#000; }
  .sheet{ width:100%; }
  .title{ text-align:center; font-size:28px; font-weight:700; letter-spacing:1px; margin:4px 0 8px; }
  .top-wrap{ display:grid; grid-template-columns:1.2fr 1fr; gap:6px; }
  .left-box{ border:2px solid #000; padding:6px 10px 8px; height:120px; display:grid; grid-template-rows:34px 1fr; }
  .logo-line{ display:flex; align-items:center; justify-content:center; height:34px; font-weight:700; overflow:hidden; }
  .logo-line span{ display:inline-block; white-space:nowrap; }
  .stamp-area{ border:1px solid #000; margin:6px 0 0; height:72px; display:flex; align-items:center; justify-content:center; font-weight:700; }
  .right-box{ display:grid; grid-template-columns:34px 1fr; gap:0; }
  .vlabel{ writing-mode:vertical-rl; text-orientation:upright; border:2px solid #000; border-right:none; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:18px; letter-spacing:2px; }
  .meta{ border:2px solid #000; border-left:none; }
  .meta table{ width:100%; border-collapse:collapse; }
  .meta td{ border:1px solid #000; padding:6px; font-size:13px; }
  .meta td.label{ background:#f7f7f7; width:110px; font-weight:700; }
  .amount-bar{ margin:8px 0 6px; display:grid; grid-template-columns:1fr auto; align-items:center; }
  .amount-left{ border-top:2px solid #000; border-bottom:2px solid #000; padding:6px 8px; font-weight:700; }
  .amount-right{ font-weight:700; }
  table.grid{ width:100%; border-collapse:collapse; border-top:2px solid #000; border-bottom:2px solid #000; }
  .grid th,.grid td{ border:1px solid #000; padding:6px; font-size:13px; }
  .grid th{ background:#f7f7f7; }
  .l{text-align:left;} .c{text-align:center;} .num{text-align:right;}
  .sum{ width:100%; border-left:2px solid #000; border-right:2px solid #000; border-bottom:2px solid #000; }
  .sum td{ border-top:1px solid #000; padding:8px; font-weight:700; }
</style>
</head>
<body>
  <div class="sheet">
    <div class="title">ê±°ë˜ëª…ì„¸ì„œ</div>

    <div class="top-wrap">
      <div class="left-box">
        <div class="logo-line"><span id="partnerTitle">${titleText}</span></div>
      </div>

      <div class="right-box">
        <div class="vlabel">ê³µ ê¸‰ ì</div>
        <div class="meta">
          <table>
            <tr>
              <td class="label">ì¼ë ¨ë²ˆí˜¸</td><td>${today}-1</td>
              <td class="label">TEL</td><td>${company.tel}</td>
            </tr>
            <tr>
              <td class="label">ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</td><td>${company.bizNo}</td>
              <td class="label">ì„±ëª…</td><td>${company.ceo}</td>
            </tr>
            <tr>
              <td class="label">ìƒí˜¸</td><td colspan="3">${company.name}</td>
            </tr>
            <tr>
              <td class="label">ì£¼ì†Œ</td><td colspan="3">${company.addr}</td>
            </tr>
          </table>
        </div>
      </div>
    </div>

    <div class="amount-bar">
      <div class="amount-left">ê¸ˆ&nbsp;&nbsp;ì•¡ : ${korAmt}</div>
      <div class="amount-right">(ï¿¦${(total).toLocaleString()})</div>
    </div>

    <table class="grid">
      <thead>
        <tr>
          <th class="c" style="width:70px;">ì¼ì</th>
          <th class="l">í’ˆëª©ëª…[ê·œê²©]</th>
          <th class="c" style="width:120px;">ìˆ˜ëŸ‰(ë‹¨ìœ„í‘œì‹œ)</th>
          <th class="num" style="width:100px;">ë‹¨ê°€</th>
          <th class="num" style="width:120px;">ê³µê¸‰ê°€ì•¡</th>
          <th class="num" style="width:100px;">ë¶€ê°€ì„¸</th>
          <th class="num" style="width:100px;">ì´ ê¸ˆì•¡</th>
        </tr>
      </thead>
      <tbody>
        ${rowsHtml}${filler}
      </tbody>
    </table>

    <table class="sum">
      <tr>
        <td class="c" style="width:80px;">ìˆ˜ëŸ‰</td>
        <td class="num" style="width:120px;">${sumQty.toLocaleString()}</td>
        <td class="c" style="width:120px;">ê³µê¸‰ê°€ì•¡</td>
        <td class="num" style="width:140px;">${totalSupply.toLocaleString()}</td>
        <td class="c" style="width:60px;">VAT</td>
        <td class="num" style="width:120px;">${totalVat.toLocaleString()}</td>
        <td class="c" style="width:80px;">í•©ê³„</td>
        <td class="num" style="width:140px;">${(total).toLocaleString()}</td>
        <td class="c" style="width:80px;">ì¸ìˆ˜</td>
        <td class="num" style="width:100px;"></td>
      </tr>
    </table>
  </div>
</body>
</html>`;

    const win = window.open('', '_blank', 'width=980,height=1200');
    win.document.open();
    win.document.write(html);
    win.document.close();

    win.onload = () => {
      try {
        const box = win.document.querySelector('.logo-line');
        const span = win.document.getElementById('partnerTitle');
        if (box && span){
          const PADDING = 12; let size = 26;
          span.style.whiteSpace='nowrap';
          while(size>=14){
            span.style.fontSize=size+'px';
            if(span.scrollWidth <= box.clientWidth - PADDING) break;
            size--;
          }
        }
      } catch {}
      setTimeout(()=>{ win.focus(); win.print(); }, 50);
    };
  }

  async function onPrint(){
    const selected = grid.getSelectedData() || [];
    if (selected.length===0){ toast('ì¸ì‡„í•  í–‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }

    const partners = Array.from(new Set(selected.map(r => (r.partnerName||'').trim())));
    if (partners.length > 1){
      toast('ì„œë¡œ ë‹¤ë¥¸ ê±°ë˜ì²˜ê°€ í•¨ê»˜ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤. ê°™ì€ ê±°ë˜ì²˜ë§Œ ì„ íƒ í›„ ì¸ì‡„í•´ì£¼ì„¸ìš”.');
      return;
    }
    const company = await fetchCompany();
    openPrintWindow(selected, company);
  }

  /* ===== ê³µí†µ ëª¨ë‹¬ í˜¸ì¶œ ===== */
  function useCommonModalOrWarn(){
    const has = !!document.getElementById('commonModal');
    if(!has){ toast('ê³µí†µ ëª¨ë‹¬ì´ í˜ì´ì§€ì— í¬í•¨ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. (common/modal :: commonModal)'); }
    return has && typeof openModal === 'function';
  }

  document.getElementById('btn-find-partner')?.addEventListener('click', ()=>{
    if(!useCommonModalOrWarn()) return;
    openModal('partner',(row)=>{
      document.getElementById('s-partner').value =
        row?.partnerName || row?.customerName || row?.clientName || row?.buyerName || row?.supplierName || '';
    });
  });

  document.getElementById('btn-find-product')?.addEventListener('click', ()=>{
    if(!useCommonModalOrWarn()) return;
    // modal.jsì— product ì„¤ì • ì¶”ê°€ í•„ìš”(ë˜ëŠ” salesë¡œ ëŒ€ì²´)
    openModal('product',(row)=>{
      document.getElementById('s-product').value =
        row?.productName || row?.itemName || row?.goodsName || row?.prodName || '';
    });
  });

  // ì—”í„°í‚¤ë¡œë„ ëª¨ë‹¬ ì—´ê¸°
  [document.getElementById('s-partner'), document.getElementById('s-product')].forEach((el,idx)=>{
    el?.addEventListener('keydown',(e)=>{
      if(e.key==='Enter'){
        e.preventDefault();
        (idx===0?document.getElementById('btn-find-partner'):document.getElementById('btn-find-product'))?.click();
      }
    });
  });

  /* ì´ë²¤íŠ¸ ë°”ì¸ë”© (í˜ì´ì§€ ë‚´ <form>ì˜ submit ë°©ì§€ìš© ì•ˆì „ì¥ì¹˜ë„ ì¶”ê°€) */
  document.getElementById('btn-search').addEventListener('click', (e)=>{ e.preventDefault(); search(); });
  document.getElementById('btn-reset' ).addEventListener('click', (e)=>{ e.preventDefault(); resetForm(); });
  document.getElementById('btn-print' ).addEventListener('click', (e)=>{ e.preventDefault(); onPrint(); });

  /* ë¶€íŠ¸ìŠ¤íŠ¸ë© */
  initDates();
  search();
})();
</script>
</body>
</html>
