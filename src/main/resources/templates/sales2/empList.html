<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/main}">

<head>
<!-- Tabulator CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link href="https://unpkg.com/tabulator-tables@5.5.2/dist/css/tabulator.min.css" rel="stylesheet">

<!-- Custom CSS -->
<style>
.flex-container {
  display: flex;
  flex-direction: row;
  align-items: flex-start;
  gap: 20px;
  margin-top: 40px;
}

.table-box {
  flex: 1;
  min-width: 0; /* flex 안에서 테이블 잘리거나 밀림 방지 */
}

.table-box.left {
  flex: 0 0 50%;
}

.table-box.right {
  flex: 0 0 50%;
}

.table-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
  height: 40px;
}

.table-header h3 {
  margin: 0;
  display: flex;
  align-items: center;
}

/* === 공용 오버레이 === */
.position-relative { position: relative; }
.loading-overlay {
  position: absolute;
  inset: 0;
  background: rgba(255,255,255,.75);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1055;
  pointer-events: all; /* 클릭 차단 */
}
.loading-overlay.d-none { display: none; }
</style>

<meta name="_csrf" th:content="${_csrf.token}" />
<meta name="_csrf_header" th:content="${_csrf.headerName}" />
</head>

<body layout:fragment="content">
	<div id="layoutSidenav_content">
		<main>
			<div class="container-fluid px-4">
			 <h2 class="mt-4">사원별 영업계획목록</h2>

			<div class="flex-container">
			  <!-- 왼쪽: 사원 목록 -->
			  <div class="table-box left">
			    <div class="table-header">
			      <h3 class="mb-0">사원 목록</h3>

			      <div class="input-group mb-3" style="width: auto; position: relative; display: flex; align-items: center; gap: 5px; margin-top: 17px;">
			        <input id="employeeName" type="text" class="form-control"
			               placeholder="사원명 입력"
			               style="width: 200px; padding-right: 25px; height: 38px;">
			        <input type="hidden" id="employCode" name="employCode">
			        <input type="hidden" id="espCode" name="espCode">
			        <i class="fas fa-search" id="search-icon"
			           style="position: absolute; right: 70px; top: 50%; transform: translateY(-50%); cursor: pointer; font-size: 16px;"
			           onclick="openModal('employee', function(selected) {
			             document.getElementById('employCode').value = selected.empNo;
			             document.getElementById('employeeName').value = selected.name;
			           })"></i>
			        <button id="btn-search" class="btn btn-warning" type="button" style="height: 38px;">검색</button>
			      </div>
			    </div>
			    <!-- 사원별 영업매출 테이블 -->
			    <div id="empPlanList-table"></div>
			  </div>

			  <!-- 오른쪽: 영업계획 입력 -->
			  <div class="table-box right">
			    <div class="table-header">
			      <h3 id="plan-title" class="mb-0">영업계획</h3>
			      <div style="display: flex; align-items: center; gap: 5px;">
			        <button type="button" class="btn btn-primary" id="btn-update-sales" style="height: 38px;">저장</button>
			        <button type="button" class="btn btn-outline-dark" id="btn-cancel-update" style="height: 38px;">초기화</button>
			      </div>
			    </div>

			    <!-- ▼ 등록 패널에 오버레이를 덮기 위해 position-relative 래퍼 -->
			    <div class="position-relative">
			      <div id="plan-table"></div>

			      <!-- 등록(오른쪽 패널) 진행중 오버레이 -->
			      <div id="emp-save-loading" class="loading-overlay d-none">
			        <div class="text-center">
			          <div class="spinner-border" role="status" aria-hidden="true"></div>
			          <div class="mt-2 fw-semibold">로딩 중…</div>
			        </div>
			      </div>
			    </div>
			  </div>
			</div>

			<!-- 수정 모달 -->
            <div class="modal fade" id="modifySalesModal" tabindex="-1" aria-hidden="true">
              <div class="modal-dialog modal-xl">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">사원별 영업계획 수정</h5>
                    <div class="ms-auto d-flex gap-2">
                      <button type="button" class="btn btn-primary" id="btn-update-sales">저장</button>
                      <button type="button" class="btn btn-outline-dark" id="btn-cancel-update">초기화</button>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                  </div>

                  <!-- ▼ 모달에도 오버레이 덮을 수 있도록 position-relative -->
                  <div class="modal-body position-relative">
                    <div id="empListTable"></div>

                    <!-- 수정(모달) 진행중 오버레이 -->
                    <div id="emp-update-loading" class="loading-overlay d-none">
                      <div class="text-center">
                        <div class="spinner-border" role="status" aria-hidden="true"></div>
                        <div class="mt-2 fw-semibold">로딩 중…</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

			</div>
		</main>
	</div>

	<div th:replace="common/modal :: commonModal"></div>

	<!-- Tabulator JS -->
	<script src="https://unpkg.com/tabulator-tables@5.5.2/dist/js/tabulator.min.js"></script>
	<!-- 기존 JS 파일 연결 -->
	<script th:src="@{/sales2/js/empList.js}"></script>
</body>
</html>
