<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">

<head>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link href="https://unpkg.com/tabulator-tables@5.5.2/dist/css/tabulator.min.css" rel="stylesheet">
<!-- âœ… Bootstrap Icons (ìˆ˜ëŸ‰ ì¹´ë“œ ì•„ì´ì½˜ìš©) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

<meta name="_csrf" th:content="${_csrf.token}" />
<meta name="_csrf_header" th:content="${_csrf.headerName}" />

<style>
.container-fluid { padding: 20px 40px; }

.view-buttons {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
}

.view-btn {
  border: 1px solid #ccc;
  background-color: #f8f9fa;
  padding: 6px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
}

.view-btn.active {
  background-color: #198754;
  color: white;
  border-color: #198754;
}

.filter-bar {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 25px;
}

.filter-bar select,
.filter-bar input {
  height: 36px;
  padding: 0 8px;
  border-radius: 4px;
  border: 1px solid #ccc;
}

.filter-bar button {
  background-color: #ff914d;
  color: white;
  border: none;
  border-radius: 4px;
  padding: 6px 12px;
}
.grid{
  display: grid;
  grid-template-columns: repeat(12, 1fr);
  gap: 12px;
  margin-bottom: 16px;
}
.card{
  grid-column: span 4; /* 3ì¥ í•œ ì¤„ */
  background: #fff;
  border: 1px solid #e5e7eb;
  border-radius: 10px;
  padding: 16px 18px;
  box-shadow: 0 2px 10px rgba(0,0,0,.04);
}
.kpi{
  display:flex; align-items:center; justify-content:space-between; gap:14px;
}
.kpi .t{ font-size: .92rem; color:#6b7280; }
.kpi .v{ font-size: 1.4rem; font-weight: 700; color:#111827; }
.kpi i{ font-size: 1.6rem; color:#94a3b8; }

/* í…Œì´ë¸”+ì°¨íŠ¸ 2ë‹¨ */
.grid-and-chart{ display:flex; gap:12px; align-items:stretch; }
#sales-table{ flex: 1 1 58%; min-width:0; box-sizing:border-box; }
.chart-panel{ flex: 0 1 40%; min-width:280px; box-sizing:border-box; }
.chart-wrap{ height:360px; min-height:360px; max-height:360px; overflow:hidden; position:relative; }
#profitChart{ width:100% !important; height:100% !important; display:block; }

@media (max-width: 1200px){
  .grid{ grid-template-columns: 1fr; }
  .card{ grid-column: span 1; }
  .grid-and-chart{ flex-direction:column; }
  #sales-table, .chart-panel{ flex: 1 1 auto; width:100%; }
  .chart-wrap{ height:320px; min-height:320px; max-height:320px; }
}
.kpi i { font-size: 1.6rem; }
.card:nth-child(1) .kpi i { color:#6c8cff; }  /* íŒë§¤ìˆ˜ëŸ‰ */
.card:nth-child(2) .kpi i { color:#22c55e; }  /* ê³µê¸‰ê°€ì•¡ */
.card:nth-child(3) .kpi i { color:#0ea5e9; }  /* í•©ê³„ê¸ˆì•¡ - ì‚¬ì›ë³„ê³¼ ë™ì¼ ìƒ‰ìƒìœ¼ë¡œ í†µì¼ */


/* ğŸ”§ ê·¸ë¦¬ë“œ ì£¼ë³€ ì—¬ë°± ìµœì†Œí™” */
h3.mt-4.mb-4 { margin-top: 12px !important; margin-bottom: 8px !important; }
#sales-table { margin-top: 0 !important; }

/* âœ… KPI ì¹´ë“œ ê·¸ë¦¬ë“œ */
.kpi i{
  /* ê³ ì • ë°•ìŠ¤ */
  width: 46px !important;
  height: 46px !important;
  flex: 0 0 46px !important;

  /* ê°€ìš´ë° ì •ë ¬ */
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;

  /* ì‹¤ì œ ì•„ì´ì½˜ í¬ê¸° */
  font-size: 30px !important;   /* BS ì•„ì´ì½˜/FA ëª¨ë‘ ë™ì¼í•˜ê²Œ í¼ */
  line-height: 1 !important;
}

/* ================================
   âœ… ì•„ì´ì½˜ í¬ê¸° '28Ã—28'ë¡œ ì™„ì „ ê³ ì • (ì¤‘ë³µ ê·œì¹™ ì œê±°)
   ================================ */
/* ì¹´ë“œ ì•„ì´ì½˜ í•œ ë‹¨ê³„ ë” ì¶•ì†Œ & í†µì¼ */
.grid .card .kpi i,
.grid .card .kpi svg {
  width: 28px !important;
  height: 28px !important;
  flex: 0 0 28px !important;
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  line-height: 1 !important;
  font-size: 20px !important; /* ê¸°ë³¸ ì‚¬ì´ì¦ˆ */
}

/* Font Awesome( fas / fa- )ëŠ” ì‚´ì§ í‚¤ì›Œ ì‹œê° ë³´ì • */
.grid .card .kpi i.fas,
.grid .card .kpi i.fa-solid,
.grid .card .kpi i.fa-regular,
.grid .card .kpi i.fa-light,
.grid .card .kpi i.fa-thin {
  font-size: 28px !important;
}

/* Bootstrap Icons(ì²« ë²ˆì§¸ ì¹´ë“œ ì•„ì´ì½˜ bi- ê³„ì—´)ë„ ì†Œí­ ë³´ì • */
.grid .card .kpi i.bi {
  font-size: 28px !important;
}
</style>
</head>

<body layout:fragment="content">
<div id="layoutSidenav_content">
  <main>
    <div class="container-fluid px-4">
      <h1 class="mt-4 mb-4">ì˜ì—…ì´ìµê´€ë¦¬</h1>

      <!-- ë³´ê¸° íƒ­ ë²„íŠ¼ -->
      <ul class="nav nav-tabs">
        <li class="nav-item">
          <button class="nav-link" id="btnProductView">í’ˆëª©ë³„</button>
        </li>
        <li class="nav-item">
          <button class="nav-link active" id="btnEmployeeView">ì‚¬ì›ë³„</button>
        </li>
      </ul>

      <!-- í•„í„° ì˜ì—­ -->
      <div class="filter-bar">
        <label>ë…„ë„ :</label>
        <select id="yearSelect"></select>

        <label>ë¶„ê¸° :</label>
        <select id="quarterSelect">
          <option value="">ì „ì²´</option>
          <option value="1">1ë¶„ê¸°</option>
          <option value="2">2ë¶„ê¸°</option>
          <option value="3">3ë¶„ê¸°</option>
          <option value="4">4ë¶„ê¸°</option>
        </select>

        <!-- ì‚¬ì› ê²€ìƒ‰ -->
        <div class="d-flex align-items-center justify-content-between mb-3 mt-3">
          <div class="input-group" style="width:350px;">
            <input id="name" type="text" class="form-control" placeholder="ì‚¬ì›ëª… ì…ë ¥">
            <input type="hidden" id="empCode" name="empCode">
            <i class="fas fa-search"
               style="position: absolute; right: 80px; top: 50%; transform: translateY(-50%); cursor: pointer;"
               onclick="openModal('employee', function(selected) {
                 document.getElementById('empCode').value = selected.empCode;
                 document.getElementById('name').value = selected.name;
               })"></i>
            <button id="btn-search" class="btn btn-warning" type="button" style="margin-left:10px;">ê²€ìƒ‰</button>
          </div>
        </div>
      </div>

      <!-- âœ… KPI ì¹´ë“œ (ë¶€ê°€ì„¸ ì¹´ë“œ/í‘œì‹œ ì—†ìŒ) -->
      <div class="grid">
        <div class="card">
           <div class="kpi">
            <div>
              <div class="t">ì´ íŒë§¤ìˆ˜ëŸ‰</div>
              <div class="v" id="totalSalesCount">0</div>
            </div>
            <!-- ë°•ìŠ¤ ì•„ì´ì½˜ + ìƒ‰ìƒ -->
            <i class="bi bi-box-seam" style="color:#6c8cff;"></i>
          </div>
        </div>
        <div class="card">
          <div class="kpi">
            <div>
              <div class="t">ì´ ê³µê¸‰ê°€ì•¡</div>
              <div class="v" id="totalSupply">0</div>
            </div>
            <i class="fas fa-coins" style="color:#22c55e;"></i>
          </div>
        </div>
        <div class="card">
          <div class="kpi">
            <div>
              <div class="t">ì´ í•©ê³„ê¸ˆì•¡</div>
              <div class="v" id="totalAmount">0</div>
            </div>
            <i class="fas fa-file-invoice-dollar" style="color:#0ea5e9;"></i>
          </div>
        </div>
      </div>

      <!-- ì‚¬ì›ë³„ ì‹¤ì  ì¡°íšŒ í…Œì´ë¸” -->
      <h3 class="mt-4 mb-4">ì‚¬ì›ë³„ ì‹¤ì  ì¡°íšŒ</h3>
      <div id="sales-table"></div>
    </div>

    <!-- ì‚¬ì› ìƒì„¸ ëª¨ë‹¬ -->
    <div class="modal fade" id="employeeModal" tabindex="-1" aria-labelledby="employeeModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title" id="employeeModalLabel">íŒë§¤ëª©ë¡</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
          </div>

          <div class="modal-body">
            <!-- ê²€ìƒ‰ ì˜ì—­ -->
            <div class="d-flex align-items-center mb-3">
              <label class="fw-bold me-2">ê²€ìƒ‰:</label>
              <div style="position: relative; display: inline-block;">
                <input id="modal-searchInput" type="text" placeholder="ê±°ë˜ì²˜ëª… ì…ë ¥" style="width:180px; padding-right:30px;">
                <i class="fas fa-search"
                  id="modal-searchIcon"
                  style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); color: #888; cursor: pointer;"></i>
              </div>
              <button id="modal-btn-search" class="btn btn-warning btn-sm ms-2">ê²€ìƒ‰</button>
            </div>

            <!-- íŒë§¤ í…Œì´ë¸” -->
            <div id="employee-sales-table"></div>
          </div>

          <div class="modal-footer">
          </div>
        </div>
      </div>
    </div>

  </main>
</div>

<script src="https://unpkg.com/tabulator-tables@5.5.2/dist/js/tabulator.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<script th:src="@{/sales2/js/employeeProfits.js}"></script>

<!-- ê³µí†µ ëª¨ë‹¬ -->
<div th:replace="common/modal :: commonModal"></div>
</body>
</html>
