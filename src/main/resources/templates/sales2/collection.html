<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/main}">

<head>
  <!-- ✅ FontAwesome & Tabulator -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link href="https://unpkg.com/tabulator-tables@5.5.2/dist/css/tabulator.min.css" rel="stylesheet">

  <meta name="_csrf" th:content="${_csrf.token}" />
  <meta name="_csrf_header" th:content="${_csrf.headerName}" />

  <style>
    .custom-modal {
      max-width: 900px;
    }
    .modal-body {
      padding: 30px 40px;
    }
    .modal-content {
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    }
    #resultTable {
      margin-top: 20px;
    }
    .tabulator-header {
      background: #f8f9fa;
    }
    
  </style>
</head>

<body layout:fragment="content">
<div id="layoutSidenav_content">
	<main>
    <div class="container-fluid px-4">
      <h1 class="mt-4">수금관리</h1>

      <!-- 검색 + 버튼 영역 -->
      <div class="d-flex align-items-center justify-content-between mb-3 mt-3">

        <!-- 거래처 검색 -->
        <div class="input-group" style="width:400px;">
          <span class="input-group-text" style="margin-right:5px;">거래처 검색</span>
          <input id="partnerName" type="text" class="form-control" placeholder="거래처명 입력">
          <input type="hidden" id="partnerCode" name="partnerCode">
          <i class="fas fa-search"
             style="position: absolute; right: 80px; top: 50%; transform: translateY(-50%); cursor: pointer;"
             onclick="openModal('partner', function(selected) {
               document.getElementById('partnerCode').value = selected.partnerCode;
               document.getElementById('partnerName').value = selected.partnerName;
             })"></i>
          <button id="btn-search" class="btn btn-warning" type="button" style="margin-left:10px;">검색</button>
        </div>

        <!-- 버튼 그룹 -->
        <div class="d-flex gap-2">
          <button id="btn-excel" class="btn btn-secondary">Excel</button>
          <button id="btn-pdf" class="btn btn-secondary">PDF</button>
        </div>
      </div>

      <!-- 메인 Tabulator 테이블 -->
      <div id="sales-table"></div>

      <div id="total-count" class="mt-2 fw-bold">
        총 거래처: <span class="text-primary">0건</span>
      </div>

      <!-- 수금 등록 모달 -->
      <div class="modal fade" id="insertCollectionModal" tabindex="-1" aria-labelledby="insertCollectionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered custom-modal">
          <div class="modal-content">

            <div class="modal-header d-flex justify-content-between align-items-center">
			  <h5 class="modal-title fw-bold" id="insertCollectionModalLabel">수금 등록</h5>
			  
			  <div class="d-flex align-items-center gap-2">
			    <button id="btnSave" class="btn btn-primary">수금등록</button>
			    <button id="btnView" class="btn btn-secondary">미수내역 조회</button>
			    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			  </div>
			</div>

            
            <div class="modal-body">
            <input type="hidden" id="outstandingAmt">
              <div class="row mb-3">
                <div class="col-md-4">
                  <label class="form-label">*수금일자</label>
                  <input type="date" id="moneyDate" class="form-control" value="2025-10-10">
                </div>                
                <div class="col-md-4">
                  <label class="form-label">*거래처</label>
                  <input type="text" id="modalPartnerName" class="form-control" placeholder="거래처명 입력">
                </div>
                <div class="col-md-4">
                  <label class="form-label">*담당자</label>
                  <input type="text" id="managerName" class="form-control" placeholder="담당자명 입력">
                </div>
              </div>

              <div class="row mb-3">
                <div class="col-md-4">
                  <label class="form-label">*수금금액</label>
                  <input type="text" id="collectAmt" class="form-control" placeholder="금액 입력">
                </div>
                <div class="col-md-4">
                  <label class="form-label">*결제방식</label>
                  <select id="paymentType" class="form-select">
                    <option value="">선택</option>
                    <option value="현금">현금</option>
                    <option value="계좌이체">계좌이체</option>
                    <option value="카드">카드</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label class="form-label">비고</label>
                  <input type="text" id="remarks" class="form-control" placeholder="비고 입력">
                  <input type="hidden" id="partnerCode" name="partnerCode">
                </div>
              </div>

              <!-- 수금 처리 결과 Tabulator -->
              <h6 class="fw-bold mb-2">수금 처리 결과</h6>
              <div id="resultTable"></div>

            </div>
          </div>
        </div>
      </div>

    </div>
  </main>
</div>

<!-- 공통 모달 -->
<div th:replace="common/modal :: commonModal"></div>

<!-- Tabulator JS -->
<script src="https://unpkg.com/tabulator-tables@5.5.2/dist/js/tabulator.min.js"></script>

<!-- Bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- 별도 JS 파일 -->
<script th:src="@{/sales2/js/collection.js}"></script>

</body>
</html>

